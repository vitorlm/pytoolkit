#!/bin/bash

# Enhanced Weekly Metrics Report Script
# Purpose: Generate comprehensive performance reports combining JIRA, SonarQube, and LinearB data
# Usage: Run this script weekly to get consistent metrics for analysis
# Supports both team-specific and tribe-wide reporting based on configuration

# Handle help option
if [[ "$1" == "--help" || "$1" == "-h" ]]; then
    echo "üöÄ Weekly Metrics Report Script"
    echo ""
    echo "DESCRIPTION:"
    echo "  Generates comprehensive weekly reports combining JIRA, SonarQube, and LinearB metrics."
    echo "  Automatically detects configuration type and adapts behavior accordingly."
    echo ""
    echo "USAGE:"
    echo "  ./run_reports.sh              # Interactive mode (if multiple configs)"
    echo "  ./run_reports.sh --help       # Show this help"
    echo ""
    echo "CONFIGURATION:"
    echo "  Place .env files in the scripts/ directory:"
    echo "  ‚Ä¢ config_reports.env          - Team-specific reporting"
    echo "  ‚Ä¢ config_reports_tribe.env    - Tribe-wide reporting"
    echo ""
    echo "OUTPUT:"
    echo "  Reports are generated in ../output/ with timestamps:"
    echo "  ‚Ä¢ team_weekly_reports_YYYYMMDD/    (team mode)"
    echo "  ‚Ä¢ tribe_weekly_reports_YYYYMMDD/   (tribe mode)"
    echo ""
    echo "FEATURES:"
    echo "  ‚úì Intelligent configuration detection"
    echo "  ‚úì Interactive selection for multiple configs"
    echo "  ‚úì Adaptive JIRA filtering and SonarQube project selection"
    echo "  ‚úì Consolidated reporting with analysis recommendations"
    echo ""
    exit 0
fi

set -e  # Exit on any error

# Function to display available configurations
show_config_menu() {
    echo ""
    echo "üîß Multiple configuration files found!"
    echo "Please select which configuration to use:"
    echo ""
    
    local configs=("$@")
    for i in "${!configs[@]}"; do
        local config="${configs[$i]}"
        local mode_type=""
        local description=""
        
        if [[ "$config" == *"tribe"* ]]; then
            mode_type="TRIBE-WIDE"
            description="Complete tribe reporting (no team filtering)"
        else
            mode_type="TEAM-SPECIFIC"
            description="Individual team reporting with filters"
        fi
        
        printf "   %d) %-25s [%s] - %s\n" $((i+1)) "$config" "$mode_type" "$description"
    done
    
    echo ""
    echo "   0) Exit"
    echo ""
}

# Function to get user selection
get_user_selection() {
    local configs=("$@")
    local max_options=${#configs[@]}
    
    while true; do
        echo -n "üëâ Select option (0-$max_options): "
        read -r selection
        
        if [[ "$selection" == "0" ]]; then
            echo "‚ùå Exiting script."
            exit 0
        elif [[ "$selection" =~ ^[1-9][0-9]*$ ]] && [ "$selection" -le "$max_options" ]; then
            return $((selection - 1))
        else
            echo "‚ö†Ô∏è  Invalid selection. Please enter a number between 0 and $max_options."
        fi
    done
}

# Auto-detect configuration files and handle selection
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
cd "$SCRIPT_DIR"

# Find all config files
CONFIG_FILES=($(ls config_reports*.env 2>/dev/null || true))

if [ ${#CONFIG_FILES[@]} -eq 0 ]; then
    echo "‚ùå No configuration files found in $SCRIPT_DIR"
    echo ""
    echo "Please create one of the following:"
    echo "   ‚Ä¢ config_reports_tribe.env   - For tribe-wide reports"
    echo "   ‚Ä¢ config_reports.env         - For team-specific reports"
    echo ""
    exit 1
elif [ ${#CONFIG_FILES[@]} -eq 1 ]; then
    # Single config file found - use it directly
    SELECTED_CONFIG="${CONFIG_FILES[0]}"
    echo "üîß Found configuration: $SELECTED_CONFIG"
else
    # Multiple config files found - show interactive menu
    show_config_menu "${CONFIG_FILES[@]}"
    get_user_selection "${CONFIG_FILES[@]}"
    SELECTED_CONFIG="${CONFIG_FILES[$?]}"
    echo ""
    echo "‚úÖ Selected configuration: $SELECTED_CONFIG"
fi

# Load the selected configuration
echo "üîß Loading configuration from $SELECTED_CONFIG..."
source "$SELECTED_CONFIG"

# Determine mode based on config file name
TRIBE_MODE=false
if [[ "$SELECTED_CONFIG" == *"tribe"* ]]; then
    TRIBE_MODE=true
fi

# --- Ensure Python venv is active ---
# Navigate back to project root for Python operations
cd ..

if [ -z "$VIRTUAL_ENV" ]; then
    if [ -f ".venv/bin/activate" ]; then
        echo "üêç Activating Python virtual environment (.venv)..."
        source .venv/bin/activate
    else
        echo "‚ùå Python virtual environment not found. Run ./setup.sh to create it."
        exit 1
    fi
else
    echo "üêç Python virtual environment already active."
fi

# Configuration (with defaults if not loaded from config)
PROJECT_KEY="${PROJECT_KEY:-CWS}"
SONARQUBE_ORGANIZATION="${SONARQUBE_ORGANIZATION:-syngenta-digital}"
INCLUDE_OPTIONAL_REPORTS="${INCLUDE_OPTIONAL_REPORTS:-true}"
CLEAR_CACHE="${CLEAR_CACHE:-true}"
USE_DATE_SUFFIX="${USE_DATE_SUFFIX:-true}"
OUTPUT_BASE_DIR="${OUTPUT_BASE_DIR:-output}"

# Mode-specific configuration
if [ "$TRIBE_MODE" = true ]; then
    # Tribe-wide configuration
    LINEARB_TEAM_ID="${TRIBE_LINEARB_TEAM_ID:-19767}"
    REPORT_SCOPE="tribe"
    echo "üìä Mode: TRIBE-WIDE reporting"
    echo "   üë• LinearB Team: $LINEARB_TEAM_ID (tribe parent team)"
    echo "   üìã JIRA: Complete CWS project (no team filter)"
else
    # Team-specific configuration
    TEAM="${TEAM:-Catalog}"
    LINEARB_TEAM_ID="${LINEARB_TEAM_IDS:-41576}"
    REPORT_SCOPE="team"
    echo "üìä Mode: TEAM-SPECIFIC reporting"
    echo "   üë• Team: $TEAM"
    echo "   üìã LinearB Team: $LINEARB_TEAM_ID"
fi

# Set up output directory
if [ "$USE_DATE_SUFFIX" = "true" ]; then
    DATE_SUFFIX=$(date +"%Y%m%d")
    OUTPUT_DIR="${OUTPUT_BASE_DIR}/${REPORT_SCOPE}_weekly_reports_${DATE_SUFFIX}"
else
    OUTPUT_DIR="${OUTPUT_BASE_DIR}/${REPORT_SCOPE}_weekly_reports"
fi

# Clean and create output directory
if [ -d "$OUTPUT_DIR" ]; then
    echo "üßπ Cleaning existing output directory: $OUTPUT_DIR"
    rm -rf "$OUTPUT_DIR"
fi
mkdir -p "$OUTPUT_DIR"

# Create subdirectories for better organization
mkdir -p "$OUTPUT_DIR/jira"
mkdir -p "$OUTPUT_DIR/sonarqube"
mkdir -p "$OUTPUT_DIR/linearb"
mkdir -p "$OUTPUT_DIR/consolidated"

# Header
echo ""
echo "============================================================"
if [ "$TRIBE_MODE" = true ]; then
    echo "           üìä TRIBE-WIDE WEEKLY METRICS REPORT TOOL"
else
    echo "           üìä TEAM WEEKLY METRICS REPORT TOOL"
fi
echo "============================================================"
echo "üìÖ Run date:        $(date)"
echo "üè∑Ô∏è  Project:         $PROJECT_KEY"
echo "‚öôÔ∏è  Config file:     scripts/$SELECTED_CONFIG"
if [ "$TRIBE_MODE" = true ]; then
    echo "üë• Scope:           Entire tribe (no team filtering)"
else
    echo "üë• Team:            $TEAM"
fi
echo "üìÅ Output folder:   $OUTPUT_DIR"
echo ""



# --- Dynamic date range calculation ---
TODAY=$(date +%Y-%m-%d)
WEEKDAY_NUM=$(date -jf "%Y-%m-%d" "$TODAY" +%u)
THIS_MONDAY=$(date -jf "%Y-%m-%d" -v-"$((WEEKDAY_NUM - 1))"d "$TODAY" +%Y-%m-%d)
LAST_MONDAY=$(date -jf "%Y-%m-%d" -v-1w "$THIS_MONDAY" +%Y-%m-%d)
LAST_SUNDAY=$(date -jf "%Y-%m-%d" -v+6d "$LAST_MONDAY" +%Y-%m-%d)
WEEK_BEFORE_MONDAY=$(date -jf "%Y-%m-%d" -v-2w "$THIS_MONDAY" +%Y-%m-%d)
WEEK_BEFORE_SUNDAY=$(date -jf "%Y-%m-%d" -v+6d "$WEEK_BEFORE_MONDAY" +%Y-%m-%d)

JIRA_LAST_WEEK="$LAST_MONDAY to $LAST_SUNDAY"
JIRA_WEEK_BEFORE="$WEEK_BEFORE_MONDAY to $WEEK_BEFORE_SUNDAY"
JIRA_TWO_WEEKS="$WEEK_BEFORE_MONDAY to $LAST_SUNDAY"

# Print ranges
echo "üìÜ Reporting periods:"
printf "   ‚Ä¢ %-18s %s\n" "Last week:" "$JIRA_LAST_WEEK"
printf "   ‚Ä¢ %-18s %s\n" "Week before:" "$JIRA_WEEK_BEFORE"
printf "   ‚Ä¢ %-18s %s\n" "Combined 2 weeks:" "$JIRA_TWO_WEEKS"
echo ""

# Step counter for progress tracking
if [ "$TRIBE_MODE" = true ]; then
    TOTAL_STEPS=6  # Tribe mode: 6 main reports
else
    TOTAL_STEPS=8  # Team mode: 8 reports including cycle time
fi
STEP=1

# JIRA Reports
if [ "$TRIBE_MODE" = true ]; then
    # Tribe-wide reports (no team filter)
    echo "üåü [$STEP/$TOTAL_STEPS] TRIBE ‚Äì Bug & Support (Combined 2 Weeks)"
    echo "   ‚è≥ Period: $JIRA_TWO_WEEKS"
    echo "   üë• Scope: Complete tribe (CWS project)"
    ((STEP++))
    python src/main.py syngenta jira issue-adherence \
      --project-key "$PROJECT_KEY" \
      --time-period "$JIRA_TWO_WEEKS" \
      --issue-types 'Bug,Support' \
      --status-categories 'Done' \
      --include-no-due-date \
      --output-file "$OUTPUT_DIR/jira/tribe-bugs-support-2weeks.json"

    echo "üåü [$STEP/$TOTAL_STEPS] TRIBE ‚Äì Bug & Support (Last Week)"
    echo "   ‚è≥ Period: $JIRA_LAST_WEEK"
    echo "   üë• Scope: Complete tribe (CWS project)"
    ((STEP++))
    python src/main.py syngenta jira issue-adherence \
      --project-key "$PROJECT_KEY" \
      --time-period "$JIRA_LAST_WEEK" \
      --issue-types 'Bug,Support' \
      --status-categories 'Done' \
      --include-no-due-date \
      --output-file "$OUTPUT_DIR/jira/tribe-bugs-support-lastweek.json"

    echo "üåü [$STEP/$TOTAL_STEPS] TRIBE ‚Äì Bug & Support (Week Before)"
    echo "   ‚è≥ Period: $JIRA_WEEK_BEFORE"
    echo "   üë• Scope: Complete tribe (CWS project)"
    ((STEP++))
    python src/main.py syngenta jira issue-adherence \
      --project-key "$PROJECT_KEY" \
      --time-period "$JIRA_WEEK_BEFORE" \
      --issue-types 'Bug,Support' \
      --status-categories 'Done' \
      --include-no-due-date \
      --output-file "$OUTPUT_DIR/jira/tribe-bugs-support-weekbefore.json"

    echo "üåü [$STEP/$TOTAL_STEPS] TRIBE ‚Äì Task Completion (Combined 2 Weeks)"
    echo "   ‚è≥ Period: $JIRA_TWO_WEEKS"
    echo "   üë• Scope: Complete tribe (CWS project)"
    ((STEP++))
    python src/main.py syngenta jira issue-adherence \
      --project-key "$PROJECT_KEY" \
      --time-period "$JIRA_TWO_WEEKS" \
      --issue-types 'Story,Task,Epic,Technical Debt,Improvement' \
      --status-categories 'Done' \
      --include-no-due-date \
      --output-file "$OUTPUT_DIR/jira/tribe-tasks-2weeks.json"

    echo "üêõ [$STEP/$TOTAL_STEPS] TRIBE ‚Äì Open Issues (All Types)"
    echo "   ÔøΩ Current open issues for entire tribe"
    ((STEP++))
    python src/main.py syngenta jira open-issues \
      --project-key "$PROJECT_KEY" \
      --issue-types 'Bug,Support,Story,Task,Epic' \
      --output-file "$OUTPUT_DIR/jira/tribe-open-issues.json"

    echo "‚è±Ô∏è  [$STEP/$TOTAL_STEPS] TRIBE ‚Äì Cycle Time Analysis (Last Week)"
    echo "   ‚è≥ Period: $JIRA_LAST_WEEK"
    echo "   üë• Scope: Complete tribe (CWS project)"
    ((STEP++))
    python src/main.py syngenta jira cycle-time \
      --project-key "$PROJECT_KEY" \
      --time-period "$JIRA_LAST_WEEK" \
      --output-file "$OUTPUT_DIR/jira/tribe-cycle-time-lastweek.json"
else
    # Team-specific reports (with team filter)
    echo "üìä [$STEP/$TOTAL_STEPS] TEAM ‚Äì Bug & Support (Combined 2 Weeks)"
    echo "   ‚è≥ Period: $JIRA_TWO_WEEKS"
    echo "   üë• Team: $TEAM"
    ((STEP++))
    python src/main.py syngenta jira issue-adherence \
      --project-key "$PROJECT_KEY" \
      --time-period "$JIRA_TWO_WEEKS" \
      --issue-types 'Bug,Support' \
      --status-categories 'Done' \
      --include-no-due-date \
      --output-file "$OUTPUT_DIR/jira/team-bugs-support-2weeks.json" \
      --team "$TEAM"

    echo "üìä [$STEP/$TOTAL_STEPS] TEAM ‚Äì Bug & Support (Last Week)"
    echo "   ‚è≥ Period: $JIRA_LAST_WEEK"
    echo "   üë• Team: $TEAM"
    ((STEP++))
    python src/main.py syngenta jira issue-adherence \
      --project-key "$PROJECT_KEY" \
      --time-period "$JIRA_LAST_WEEK" \
      --issue-types 'Bug,Support' \
      --status-categories 'Done' \
      --include-no-due-date \
      --output-file "$OUTPUT_DIR/jira/team-bugs-support-lastweek.json" \
      --team "$TEAM"

    echo "üìä [$STEP/$TOTAL_STEPS] TEAM ‚Äì Bug & Support (Week Before)"
    echo "   ‚è≥ Period: $JIRA_WEEK_BEFORE"
    echo "   üë• Team: $TEAM"
    ((STEP++))
    python src/main.py syngenta jira issue-adherence \
      --project-key "$PROJECT_KEY" \
      --time-period "$JIRA_WEEK_BEFORE" \
      --issue-types 'Bug,Support' \
      --status-categories 'Done' \
      --include-no-due-date \
      --output-file "$OUTPUT_DIR/jira/team-bugs-support-weekbefore.json" \
      --team "$TEAM"

    echo "üìä [$STEP/$TOTAL_STEPS] TEAM ‚Äì Task Completion (2 Weeks)"
    echo "   ‚è≥ Period: $JIRA_TWO_WEEKS"
    echo "   üë• Team: $TEAM"
    ((STEP++))
    python src/main.py syngenta jira issue-adherence \
      --project-key "$PROJECT_KEY" \
      --time-period "$JIRA_TWO_WEEKS" \
      --issue-types 'Story,Task,Epic,Technical Debt,Improvement' \
      --status-categories 'Done' \
      --include-no-due-date \
      --output-file "$OUTPUT_DIR/jira/team-tasks-2weeks.json" \
      --team "$TEAM"

    echo "üêõ [$STEP/$TOTAL_STEPS] TEAM ‚Äì Open Issues (Bugs & Support)"
    echo "   üìã Current open issues for team: $TEAM"
    ((STEP++))
    python src/main.py syngenta jira open-issues \
      --project-key "$PROJECT_KEY" \
      --issue-types 'Bug,Support' \
      --team "$TEAM" \
      --output-file "$OUTPUT_DIR/jira/team-open-bugs-support.json"

    # JIRA Cycle Time Report
    echo "‚è±Ô∏è  [$STEP/$TOTAL_STEPS] TEAM ‚Äì Cycle Time Analysis (Last Week)"
    echo "   ‚è≥ Period: $JIRA_LAST_WEEK"
    echo "   üë• Team: $TEAM"
    ((STEP++))
    python src/main.py syngenta jira cycle-time \
      --project-key "$PROJECT_KEY" \
      --time-period "$JIRA_LAST_WEEK" \
      --team "$TEAM" \
      --output-file "$OUTPUT_DIR/jira/team-cycle-time-lastweek.json"
fi

# SonarQube Report
echo ""
if [ "$TRIBE_MODE" = true ]; then
    echo "üîç [$STEP/$TOTAL_STEPS] SonarQube ‚Äì Code Quality Metrics (ALL PROJECTS)"
    echo "   üìä Including all 27 Syngenta Digital projects"
else
    echo "ÔøΩ [$STEP/$TOTAL_STEPS] SonarQube ‚Äì Code Quality Metrics"
    echo "   ÔøΩ Team-specific projects"
fi
((STEP++))

CLEAR_CACHE_FLAG=""
[ "$CLEAR_CACHE" = "true" ] && CLEAR_CACHE_FLAG="--clear-cache"

if [ "$TRIBE_MODE" = true ]; then
    # Use all projects from the projects_list.json file (tribe mode)
    python src/main.py syngenta sonarqube sonarqube \
      --operation list-projects \
      --organization "$SONARQUBE_ORGANIZATION" \
      --include-measures \
      --output-file "$OUTPUT_DIR/sonarqube/tribe-quality-metrics.json" \
      $CLEAR_CACHE_FLAG
else
    # Use specific project keys (team mode)
    python src/main.py syngenta sonarqube sonarqube \
      --operation list-projects \
      --organization "$SONARQUBE_ORGANIZATION" \
      --include-measures \
      --output-file "$OUTPUT_DIR/sonarqube/team-quality-metrics.json" \
      $CLEAR_CACHE_FLAG \
      --project-keys "$SONARQUBE_PROJECT_KEYS"
fi

# LinearB Report
if [ "$TRIBE_MODE" = true ]; then
    echo "üöÄ [$STEP/$TOTAL_STEPS] LinearB ‚Äì Engineering Metrics (TRIBE PARENT TEAM)"
    LINEARB_TIME_RANGE="$WEEK_BEFORE_MONDAY,$LAST_SUNDAY"
    echo "   ‚è≥ Period: $LINEARB_TIME_RANGE"
    echo "   üë• Tribe Team ID: $LINEARB_TEAM_ID (parent team)"
else
    echo "üöÄ [$STEP/$TOTAL_STEPS] LinearB ‚Äì Engineering Metrics"
    LINEARB_TIME_RANGE="$WEEK_BEFORE_MONDAY,$LAST_SUNDAY"
    echo "   ‚è≥ Period: $LINEARB_TIME_RANGE"
    echo "   üë• Team: $TEAM (ID: $LINEARB_TEAM_ID)"
fi
((STEP++))

python src/main.py linearb export-report \
  --team-ids "$LINEARB_TEAM_ID" \
  --time-range "$LINEARB_TIME_RANGE" \
  --format csv \
  --filter-type team \
  --granularity 1w \
  --beautified \
  --return-no-data \
  --aggregation avg \
  --output-folder "$OUTPUT_DIR/linearb" \
  || echo "‚ö†Ô∏è  Warning: LinearB export report failed - check configuration"

# Generate Consolidated Summary Report
echo "üìã [$STEP/$TOTAL_STEPS] Generating Consolidated Summary Report"
((STEP++))

SUMMARY_FILE="$OUTPUT_DIR/consolidated/weekly-summary.md"

cat > "$SUMMARY_FILE" << EOF
# Weekly Metrics Summary

**Generated on:** $(date)  
**Period:** $JIRA_TWO_WEEKS  
**Project:** $PROJECT_KEY  
**Mode:** $(if [ "$TRIBE_MODE" = true ]; then echo "Tribe-wide"; else echo "Team-specific ($TEAM)"; fi)
**Config:** scripts/$SELECTED_CONFIG

## üìä Reports Generated

### JIRA Analysis
EOF

if [ "$TRIBE_MODE" = true ]; then
    cat >> "$SUMMARY_FILE" << EOF
- Bug & Support Issues (2 weeks): \`jira/tribe-bugs-support-2weeks.json\`
- Bug & Support Issues (last week): \`jira/tribe-bugs-support-lastweek.json\`
- Bug & Support Issues (week before): \`jira/tribe-bugs-support-weekbefore.json\`
- Task Completion (2 weeks): \`jira/tribe-tasks-2weeks.json\`  
- Open Issues (all types): \`jira/tribe-open-issues.json\`
- Cycle Time Analysis: \`jira/tribe-cycle-time-lastweek.json\`

### Code Quality Analysis
- SonarQube Metrics (27 projects): \`sonarqube/tribe-quality-metrics.json\`

### Engineering Metrics
- LinearB Metrics (tribe parent team): \`linearb/linearb_export*.csv\`
EOF
else
    cat >> "$SUMMARY_FILE" << EOF
- Bug & Support Issues (2 weeks): \`jira/team-bugs-support-2weeks.json\`
- Bug & Support Issues (last week): \`jira/team-bugs-support-lastweek.json\`
- Bug & Support Issues (week before): \`jira/team-bugs-support-weekbefore.json\`
- Task Completion (2 weeks): \`jira/team-tasks-2weeks.json\`
- Open Issues: \`jira/team-open-bugs-support.json\`
- Cycle Time Analysis: \`jira/team-cycle-time-lastweek.json\`

### Code Quality Analysis
- SonarQube Metrics (team projects): \`sonarqube/team-quality-metrics.json\`

### Engineering Metrics
- LinearB Metrics ($TEAM team): \`linearb/linearb_export*.csv\`
EOF
fi

cat >> "$SUMMARY_FILE" << EOF

## üìà Week-over-week Comparison Available
Compare performance between:
EOF

if [ "$TRIBE_MODE" = true ]; then
    cat >> "$SUMMARY_FILE" << EOF
- **Last week:** tribe-bugs-support-lastweek.json
- **Week before:** tribe-bugs-support-weekbefore.json
EOF
else
    cat >> "$SUMMARY_FILE" << EOF
- **Last week:** team-bugs-support-lastweek.json
- **Week before:** team-bugs-support-weekbefore.json
EOF
fi

cat >> "$SUMMARY_FILE" << EOF

## üîç Analysis Recommendations

1. **Performance Trends:** Monitor cycle times and adherence rates
2. **Quality Trends:** Track SonarQube metrics for quality gates and technical debt
3. **Bug Resolution:** Analyze bug resolution efficiency
4. **Delivery Patterns:** Identify consistent delivery patterns and potential blockers
5. **Capacity Planning:** Use historical data for future sprint planning

---
*This report provides comprehensive metrics for informed decision-making and continuous improvement.*
EOF

echo "   ‚úÖ Summary written to: $SUMMARY_FILE"

# Final Summary
echo ""
if [ "$TRIBE_MODE" = true ]; then
    echo "‚úÖ TRIBE WEEKLY REPORT GENERATION COMPLETED!"
    echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
    echo "üìÅ Output directory: $OUTPUT_DIR"
    echo ""
    echo "üìä Generated reports:"
    printf "   ‚Ä¢ %-30s %s\n" "JIRA tribe reports:" "6 files"
    printf "   ‚Ä¢ %-30s %s\n" "SonarQube analysis:" "1 file (27 projects)"
    printf "   ‚Ä¢ %-30s %s\n" "LinearB metrics:" "CSV files (tribe parent team)"
    printf "   ‚Ä¢ %-30s %s\n" "Consolidated summary:" "1 markdown file"
else
    echo "‚úÖ TEAM WEEKLY REPORT GENERATION COMPLETED!"
    echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
    echo "üìÅ Output directory: $OUTPUT_DIR"
    echo ""
    echo "ÔøΩ Generated reports:"
    printf "   ‚Ä¢ %-30s %s\n" "JIRA team reports:" "6 files"
    printf "   ‚Ä¢ %-30s %s\n" "SonarQube analysis:" "1 file (team projects)"
    printf "   ‚Ä¢ %-30s %s\n" "LinearB metrics:" "CSV files ($TEAM team)"
    printf "   ‚Ä¢ %-30s %s\n" "Consolidated summary:" "1 markdown file"
fi
echo ""
echo "üìÇ Directory structure:"
echo "   $OUTPUT_DIR/"
echo "   ‚îú‚îÄ‚îÄ jira/                   (JIRA reports)"
echo "   ‚îú‚îÄ‚îÄ sonarqube/              (Code quality metrics)"
echo "   ‚îú‚îÄ‚îÄ linearb/                (Engineering metrics)"
echo "   ‚îî‚îÄ‚îÄ consolidated/           (Summary and analysis)"
echo ""
echo "üìã Total files generated:"
TOTAL_FILES=$(find "$OUTPUT_DIR" -type f | wc -l | tr -d ' ')
echo "   $TOTAL_FILES files across all categories"
echo ""
if [ "$TRIBE_MODE" = true ]; then
    echo "üéØ Key insights available:"
    echo "   ‚Üí Complete tribe performance metrics"
    echo "   ‚Üí Week-over-week trend analysis"
    echo "   ‚Üí Quality metrics across all projects"
    echo "   ‚Üí Engineering velocity patterns"
    echo "   ‚Üí Comprehensive tribe health assessment"
else
    echo "üéØ Key insights available:"
    echo "   ‚Üí Team performance metrics"
    echo "   ‚Üí Week-over-week trend analysis"
    echo "   ‚Üí Quality metrics for team projects"
    echo "   ‚Üí Engineering velocity patterns"
    echo "   ‚Üí Team health assessment"
fi
echo ""
echo "üìñ Start analysis with: $OUTPUT_DIR/consolidated/weekly-summary.md"
